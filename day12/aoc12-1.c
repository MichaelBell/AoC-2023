#include "../aoc.h"

#include <stdbool.h>

#ifndef max
#define max(a,b)            (((a) > (b)) ? (a) : (b))
#endif

#ifndef min
#define min(a,b)            (((a) < (b)) ? (a) : (b))
#endif

#if 0
const char* data = "???.### 1,1,3\n\
.??..??...?##. 1,1,3\n\
?#?#?#?#?#?#?#? 1,3,1,6\n\
????.#...#... 4,1,1\n\
????.######..#####. 1,6,5\n\
?###???????? 3,2,1\n\
????##???#????#?#?? 6,8,1\n\
??#????#?? 5,1\n\
???#?????? 4,4\n\
??..#??#??.???? 5,1\n\
?.?.???????##????? 1,2,8\n\
???????##????? 2,8\n";
#else
const char* data = "???#?????? 4,4\n\
??..#??#??.???? 5,1\n\
?.?.???????##????? 1,2,8\n\
.#????.????#?????? 2,1,1,2,1,1\n\
??????#????...#?... 9,1\n\
.???.?????. 3,1,1\n\
??..?..???. 1,1\n\
??.??.#..?..??###?? 2,1,1,1,6\n\
????.???## 3,1,3\n\
???#?###?#?#.??? 1,1,7,1,1\n\
??.#?#???#.????????? 7,6\n\
???#?#.??##?????? 3,1,6\n\
????##???#????#?#?? 6,8,1\n\
??#????#?? 5,1\n\
?##?#??#??????##?.#? 10,5,2\n\
..???..?##???..?? 1,5,1\n\
.?.#???.??? 3,2\n\
?????#?#.???.?.?###? 1,4,1,5\n\
?##.??#..?????????? 3,3,3,1,1\n\
?#???.#?????##??? 2,1,2,4,1\n\
.???.?????.? 1,2\n\
??.?????????#?#?#?#. 2,3,2,4,3\n\
??#??##????#?.??#. 7,1,2,2\n\
??##???..????#????#. 5,4,4\n\
.##?.?????????? 2,6,2\n\
????##??.??. 4,1,1\n\
?.#??#??.#??.##?? 5,1,1,2,1\n\
??#?##???..??? 8,1,1\n\
???????.?#?????.?? 6,6\n\
?#????#?.? 1,3\n\
??.???.?.?? 2,1\n\
????#????...??#?..?. 4,2\n\
?.?#????#??## 1,2,7\n\
?.???##??#?#?#??#?? 1,1,6,1,5\n\
?????#???#?. 6,1\n\
??#????..?? 4,1\n\
?.?#?#??.?#.???? 1,1,3,1,2\n\
??##??????#???.?? 5,1,1,1,1\n\
#???###??#???????#?# 1,6,2,3,1\n\
?.#????###???.??# 1,10,2\n\
?????.?.??????##?#?# 1,1,11\n\
?#??.?????? 1,4\n\
.???#???.#?? 5,2\n\
.??.??#??### 1,2,4\n\
???#?????#???#???#?? 12,3\n\
????#????.?#?? 7,2\n\
.?.??#?#?#.????. 1,5,1\n\
??.????????.??.????# 1,2,1,1,2,4\n\
?.??.#??#???# 1,1,6\n\
?.?.???##???.?#.. 1,7,1\n\
..#.??#??#?...? 1,1,1,2,1\n\
??..?.##???#??. 1,1,2,4\n\
#?????#??.#???? 1,1,1,2,4\n\
?#?#???????? 5,1,1\n\
#?#..????.# 3,4,1\n\
??#???.???.?.?????.# 5,1,1,1,5,1\n\
#??.?.????#?????#? 1,1,1,1,4,2\n\
????##?#??????????#. 10,4\n\
???#???#?#.?????## 1,1,3,1,4\n\
????#?#.????###?#.?? 2,3,9,1\n\
?.???????.#??#? 7,1,1\n\
?#?##??##??.??#?#?. 10,5\n\
???#???.#??#.?#?? 1,3,1,2,4\n\
?#???.?.??????? 2,2,2,1\n\
.#???????##?? 2,6\n\
?.#????????#. 2,1,1,1\n\
.#.???#.?..#?##??? 1,1,2,1,7\n\
.????.?#????????# 1,11\n\
?.#?.#???# 1,1,1\n\
?.???????#?. 1,8\n\
??#?.#????#?#??.?. 1,2,4,1\n\
????#.????#????#. 1,1,2,4,1\n\
????#??????#?.? 9,1,1\n\
.???#.#?.#..#?.??#? 2,1,2,1,2,2\n\
?.#??????##? 1,3,4\n\
#.???#???.???. 1,3,2,1\n\
???#???..??.??#??#. 2,1,2,5\n\
???##??.#?# 4,3\n\
?..?.???.???.?#??? 1,1,2,3,3,1\n\
.???##?.#????#?# 5,1,1,1,1\n\
.??###.??.?? 1,3,2,2\n\
?????#?##???#?###??? 1,15\n\
??#.??.???.??#?? 1,1,2,2,1\n\
?.?#.??..?#?? 1,1,1,2\n\
?#?????#?#????.??. 10,1,1\n\
??#.#.??#.?? 1,1,1,1\n\
.??##???#??#?#??.?#? 12,1\n\
?????????????#?#?? 1,1,4,1,1,1\n\
.?.##.?###??? 2,5\n\
..?.??.??? 1,1,3\n\
.?????????????#??. 1,9\n\
.##?##???? 5,1\n\
.#?..?????? 2,1,3\n\
?????##?.. 1,6\n\
##??????##? 5,2\n\
?????.#.?#??.?? 1,1,1,1,2\n\
#..?##?.?.###... 1,4,3\n\
??##?#?????.#??? 8,1,3\n\
????.?#?.??#?#?# 2,3,5\n\
??.????????????.???? 1,1,3,1,1,4\n\
?#?????.?????? 7,2,1\n\
????#.?.?????###?. 3,1,1,2,1,4\n\
?#????###??? 2,6\n\
#???.?.#??#????# 1,1,1,5,3\n\
#.??#????.. 1,5\n\
??#???.??#???##???. 4,1,2,4,1\n\
??#??????. 3,1\n\
????..#?##????## 3,10\n\
.##??.???????? 2,1,7\n\
???.?.?#?#.?..#?.? 4,2\n\
????#???#??#? 1,1,3,1\n\
?.??#...???#?????? 3,4,3\n\
????#??#?? 2,1,1\n\
?.??????#?????.? 8,3\n\
??.??.?#??????# 1,1,1,4,1\n\
.??.???.#??? 1,2,1,1\n\
??????.?.?#? 4,1,2\n\
?.#??..?#.#? 1,1,1,1\n\
??#??.???????#?.?? 2,1,1,1,2,1\n\
??...##??.????? 4,3\n\
??##?#?##????? 1,7,1\n\
.?##???.?.# 5,1,1\n\
??..?#?#.. 1,4\n\
???##???.???##??### 1,2,1,9\n\
.?????#??? 3,2\n\
??#.???..??????##??? 2,1,11\n\
???#?????#?#????? 1,7,1,1\n\
.??.?.#?#.??#??##?#? 1,1,1,1,7\n\
#???#??.?# 1,3,1\n\
???##???.????????.?# 1,4,1,1,1,2\n\
???#?????#####?? 1,13\n\
????#??????.?? 6,2\n\
??????#?.???????#.?? 3,5\n\
?#??.??##??.?.? 3,4,1\n\
????????##?.. 7,3\n\
???###.??. 6,1\n\
.?#??????#??#??#?? 1,10,3\n\
?.?..????.??..?#?#.. 1,4\n\
.??????#??##??? 1,2,7\n\
????#??.#??##?#? 2,3,8\n\
?#???.?.?. 1,1,1\n\
.??##??#????? 3,1,1,1\n\
.?????#??#??#???? 2,3,5,1,1\n\
?#?...?###???? 2,5,1\n\
?##?.?..?.?? 3,1,1,2\n\
?##????.?????##? 2,2,2,4\n\
??#????#?#? 3,4\n\
#.??#?##?.?.?.#? 1,7,1,1,1\n\
?##?#??.?????.?? 5,2,1,1\n\
?.??#????#????#??#. 1,1,1,3,1,4\n\
?????.?#???#?? 1,1,3,2\n\
###?????????.??????? 5,1,1,1,2,1\n\
?????###???#????.?. 1,7,1,1,1\n\
???.?????#.?. 1,5,1\n\
#???###???#?#???#?? 2,4,5,2\n\
??????#???#?#?#?.?# 1,1,5,1,4,1\n\
???.#?##????#??.#? 1,1,9,2\n\
?.?????????.?? 1,5,2,1\n\
???????#?##??.?.?? 11,1\n\
????..####???? 2,8\n\
.?##?.??##???#. 3,4,1\n\
????????.?? 3,1\n\
???.#.?????#?#?..? 1,1,2,1,4,1\n\
.???????#?? 3,1\n\
???#??##?????##??? 4,2,7\n\
??#?##????.. 1,1,3,1\n\
.????????????.???.?. 1,5,4,1,1\n\
....?#????.?????#??? 2,6\n\
?.??#????.??????.# 1,2,1,1,6,1\n\
??..?##?..#????.?? 2,5\n\
#??##??#?###?#??.?? 5,9,1\n\
??##??#????#??? 5,1,4,1\n\
?.?#.?#.?.#????????? 1,1,2,1,6,1\n\
.?#??#?#?#?#?? 3,8\n\
#???????#?.?...??? 2,6,1\n\
?????????#.?????..?? 3,1,1,5,1\n\
??##?##.?????#? 3,2,1,1,1\n\
??.???###???.???. 1,5,2,1,1\n\
????##?????#?. 1,10\n\
.???..##?#??#? 1,8\n\
???????#?#??..??? 1,1,4,1,3\n\
?#???????????. 5,1,1\n\
??#?.#???? 1,1,2\n\
??????????. 5,1,1\n\
.????????????#?#. 1,13\n\
??????#??#.?#?? 9,4\n\
???????.#? 5,1\n\
???###???.???#?...? 3,1,5,1\n\
?.?????????? 1,4,1\n\
?.???????????. 1,5\n\
?????###?? 1,6\n\
#??????##????????.? 1,1,10\n\
?##????????# 9,1\n\
..?????#??#???# 7,2\n\
..?#..??????. 2,5\n\
???#?##???. 6,2\n\
.?????#???.???????# 1,3,2,1,4\n\
???.?????? 2,1\n\
??#?#?????????#??? 3,4,2,3\n\
....??#?????.?# 3,3,2\n\
?#?#??###?.????????. 1,1,5,2,2,1\n\
??#.?..??? 3,1\n\
?#???????.? 3,1\n\
.?????.??.?.??# 3,1,1,1,1\n\
??#????.?? 3,2,1\n\
???.?#??.?#.???. 2,2,1,2,2\n\
####??.????????#?? 6,1,5\n\
?##????##??#?#????? 9,4,3\n\
#.???#?#?.#??????# 1,6,1,2,1\n\
??#.???##???..?? 3,6\n\
.??.??????????#?.?? 1,5,1,2,1\n\
..???#??????? 3,3\n\
????##???. 3,1\n\
##?##?#?#?.? 9,1\n\
??????.??###??? 2,6\n\
???..??#??????#. 2,5,2\n\
???.??#????????. 2,4,5\n\
??..???.??.?..??.? 1,1\n\
??????.#?## 1,4\n\
.?##??????. 4,2\n\
???##?????#??.. 4,3\n\
.#?##.?.???? 4,1\n\
?#??#.?#??#???#?? 2,1,9\n\
.??##???????? 7,1\n\
??#??#.???#. 5,1,1\n\
?.?#?.??.?????#?? 1,2,1,1,5\n\
?#??.????#??###?#?? 4,1,9\n\
.??####??.?#?#?###? 6,8\n\
???????#..??#??#? 2,2,7\n\
.??????#???. 1,5,1\n\
??#.?#???.?? 1,2,1,1\n\
?##?????##??#.#??? 3,5,1,1,1\n\
????.??##?.?. 2,1,4\n\
.??????????##??????. 2,1,6,4\n\
?#.????.??#?? 2,2,2\n\
????#??#????????. 2,9\n\
???.??..???? 2,1,1,1\n\
??.??????#??#???#? 1,1,4,1,2\n\
##??????#???#????? 5,4,2,2\n\
#???#???????##.?#?. 9,1,2,3\n\
?.?.????.? 1,2\n\
?#??#???????. 5,1,1\n\
??###?#.???.####?## 5,1,7\n\
?????##???#?????#? 1,4,1,2,2\n\
#??.???????.? 3,1,2,1\n\
???#????#??#?#? 4,1,4\n\
??.??..??..? 2,2,1,1\n\
???????##?. 1,4\n\
.?????????????????. 1,5,2,3,1\n\
???????#??#???????? 6,5,1,1\n\
??#.?.?????.?.? 1,4,1\n\
.?????#.??#???..?.?? 1,1,1,5,1,1\n\
?#?##???#???????? 5,1,1,1,4\n\
????#?.#?#????.#?#?? 1,1,3,2,4\n\
#???#????.#????? 8,4\n\
?.????????.?#?#?? 1,3,4,1\n\
#???#???###?#?.##??? 1,11,4\n\
.?.???#??????? 1,7,1\n\
???##??.????#? 4,6\n\
????#.?#??.??.?#.??? 5,2,1,1,2,3\n\
#.#???????#??#. 1,1,2,1,1\n\
#.???#?#??#? 1,1,4,1\n\
.?#.????##?##????? 2,10\n\
.??.??.?.. 2,1,1\n\
.?#?#??????????????? 3,13\n\
?#????#.?????#? 2,1,1,3,2\n\
#?????.???#???#?.#? 1,1,7,2\n\
????.?.???.?.. 1,1,1\n\
#????#????????# 1,1,1,5,2\n\
?..??????.#?##??? 5,5\n\
..?##??????#. 4,4\n\
??##?#??#? 5,2\n\
???.??????#?.? 1,1,5,1\n\
#?#?#????#..?? 1,4,1,1\n\
???.??#.## 1,3,2\n\
?????#.?#??#??..?#.? 1,4,7,2,1\n\
##.???.#??##?##??#?? 2,2,11\n\
.#??.???.?##???#???? 1,1,1,3,5\n\
????.?????? 3,1,2\n\
???..#???. 2,1,1\n\
?.??.???##?#?#??#?# 1,1,1,8,1,1\n\
...????.?? 1,1,1\n\
#.#.??????#?? 1,1,1,5\n\
.?#???..????#? 4,2,1\n\
??.???.??????#??.? 1,1,8,1\n\
???#.?????.#?#? 1,3,1,1\n\
???????#????...??#. 11,3\n\
?#?##?##?. 2,5\n\
.???????.??? 5,1\n\
?????????????#??##. 3,10\n\
.??????#????#????##? 2,2,1,1,8\n\
.??#???????????##?? 2,9\n\
?#?#??.??.???# 5,2,4\n\
.???#???.??. 2,2\n\
????##??#????#?????? 1,4,2,2,4\n\
????????.?.?#????? 8,1,1,4\n\
.???...##???????.? 2,7\n\
???..??.??.###?? 1,5\n\
???.???#?? 2,1,1\n\
##?..??.?#. 2,1,1\n\
??????..?##??????# 1,1,2,10\n\
?????##??? 2,2,1\n\
?.??###??..?# 1,7,1\n\
#???#?#????#?????? 1,1,3,2,1,4\n\
??????#?##???#?#?. 1,2,2,2,6\n\
??.#....?#.??? 1,1\n\
#####?#?...?#?. 7,2\n\
.??.????????. 2,2,1,2\n\
?..#..??????? 1,4\n\
?##???#...?##??? 2,1,3\n\
??????#??# 1,2,1\n\
??????#????? 1,1,2,1\n\
??#???#???##????#??? 11,6\n\
.?..???#???. 1,3,2\n\
?#??##?.??. 7,1\n\
#????????.?# 2,2,1,1\n\
?..?#?????.??? 4,2\n\
?????#?#?????#?? 1,5,1,4\n\
?.??#?.#?##???#?.?? 4,8\n\
##?#???#??? 4,1,3\n\
.?.?????#?????. 2,4\n\
#??????#???#..##? 1,1,3,1,2\n\
???.???????##????? 2,1,7\n\
???#.?.#???#??? 4,1,2,2,1\n\
.##..?#??.?????#?# 2,3,1,4,1\n\
?#?????#?##???? 1,11\n\
???????#.?.?#.. 6,1,2\n\
.???????.#.?.????? 4,1,1,1,3\n\
.?.#..??.?#????#?## 1,1,1,10\n\
#?.??#??#??????###?# 1,3,3,3,5\n\
??#???#???#.???#?? 11,1,3\n\
??#?#.?????? 3,5\n\
?.?????..????##?##?? 2,1,1,6,1\n\
??????#??###? 1,1,7\n\
.???#????.??? 7,1\n\
.????##??#??#???# 1,5,1,5\n\
??#????#??#??#??#?#? 1,1,7,1,2,1\n\
?.??????????? 1,1,1\n\
?.#?#.??##????.?? 1,3,1,5,1\n\
.????.#.?????#?. 3,1,5\n\
?#?#??.???#? 1,1,1\n\
.#?#??.#??#???#.# 3,1,8,1\n\
?.????#.??????? 1,2,6\n\
??##??.?#?. 4,3\n\
#?#?##????#? 9,1\n\
?##???##???##?.?. 3,1,8,1\n\
????????#?.? 1,1,1,1\n\
???#??????# 2,2\n\
?#?..?#..???.?? 2,2,1,1,1\n\
#????.?#?? 3,3\n\
.?????.?.???#?. 2,1,1,2,2\n\
.????.?.#??. 1,1\n\
#??.?????#.??????.? 2,4,1,4\n\
?.?...????????. 3,2\n\
.##??.#??#?#??? 2,7\n\
.???.?????? 2,1,2\n\
?#???#?#????#??#??? 3,9,2\n\
??????????.???.?? 3,5,2,1\n\
????.??.???## 2,2,1,2\n\
??###.???# 4,1,1\n\
?????#???????. 3,7,1\n\
.??????#?????#???? 1,4,4,1\n\
.???#?.????## 4,3\n\
##..?????. 2,2\n\
???##???#? 3,1\n\
???##???.?????#.. 1,6,1,1,1\n\
?????##????? 2,5,1\n\
?.????????#?? 1,1,2,2\n\
.?.??????? 1,2\n\
??##..#??.?.???#?#? 4,1,1,1,4\n\
?.?#?#??#?.## 4,1,2\n\
?????????#.????#??. 8,1,3\n\
?##??#?.?.?????? 6,1,3,1\n\
??#?????#?#?#?.?#? 11,1\n\
#???...?#???.#???? 2,1,5,1,1,1\n\
?#????.?#???#??? 1,1,9\n\
.?????????# 1,3,2\n\
.?.??#?#?????.?..?? 10,1\n\
?.??#??#?.??.?.?#?? 1,6,1,3\n\
?????.??##??#?##??? 2,11\n\
?#?#???#??.#?# 1,6,1,1\n\
.??#??????##?#???# 5,1,5,1\n\
?#??????#?#???.#? 2,9,2\n\
???.?#?.????#????? 1,3,1,3,1\n\
.???.?????.??..?. 2,5,1,1\n\
?.???###?.?#????#?#? 1,4,3,2,1\n\
##??.?#..?.##?.?? 4,1,1,2,1\n\
?.???????????#?? 2,1,6\n\
??#?.???????? 4,4\n\
?#???##?.???? 4,2,2\n\
.?????##..?.?? 6,1\n\
????#?#?????#.?? 7,1\n\
#??#?#??????#????#?? 1,8,1,1,1,1\n\
.??#?????.. 3,1\n\
????.???#?????? 2,1,1,2,1\n\
??.???.?#????##??? 1,1,3,5\n\
??#?#?#.##?? 6,4\n\
??#??#????.???? 1,6,1,1,1\n\
?????..##??????. 2,1,6\n\
?#.?#?.???#.?..# 2,2,2,1,1\n\
???.#????.?#?#??? 1,5,4\n\
?????##..??????? 1,3,1,3\n\
.???.?..??. 1,1,2\n\
?.??#??#.#?.??## 2,1,1,1,2\n\
??#.????#.??? 2,1,1,3\n\
.#?.??.??? 2,1,2\n\
?????????##?? 3,4\n\
??????#????. 1,2,1,3\n\
.#.?????##???#?????# 1,4,3,4,2\n\
#??#???????? 1,4,3\n\
?#??.??#?? 2,1,3\n\
.???#?##????.?. 7,1\n\
.?#?#.?#??.? 2,1,2,1\n\
?.#?#??#?? 4,2\n\
??.???#??#?.?????.? 7,4\n\
?.?...#???????#? 1,1,2,2\n\
??.????...#? 3,1\n\
..#?.??????..?###? 1,4,4\n\
?..###???.??.?. 1,4,1,1\n\
??.?.??#?????.# 2,7,1\n\
.??.???????#? 1,5,2\n\
?####??..???#???.? 5,1,2,1,1,1\n\
?.?#????#???? 1,4,1,1\n\
??????????.??.?? 1,5,1,1\n\
?.#?..????#??## 1,1,6\n\
?????..?.?? 3,1,1\n\
.?.?#????????#.???? 1,3,1,5,1,2\n\
????#?.??#?. 3,1\n\
.##??#.??????#?#?. 5,7\n\
????????##?#???##..? 4,11,1\n\
.?.?#?#?##??#?? 1,4,5,1\n\
##.??????..#. 2,1,1,1\n\
?????.?.???#?.?????? 1,3,2\n\
##.???????.?.?# 2,3,1,1\n\
?##??####??..?? 3,4,1,1\n\
?????????#?##???##?? 3,6,4\n\
..??#??.?#.?#?.?.##. 3,1,2,2\n\
????#??????? 3,4\n\
.#????..?????????? 1,1,1,1,5\n\
????..???#??#.?#?? 3,1,1,1,3\n\
?????#???#??#? 4,2,1\n\
?????##???#???????? 2,6,1,2\n\
.?#??.?..????#? 2,1,1,1,3\n\
.???.?##???? 1,4,1\n\
.##?..#.????? 3,1,1,1\n\
#?#.?.????..#??? 3,3,1,1\n\
?#..#?#.#??#?????? 1,3,1,1,1,1\n\
?????????#????.????? 5,3\n\
???#??????.? 7,1,1\n\
..????.???#..??# 2,3,1\n\
?.?.??..##? 1,2\n\
.#?????.?#????.? 5,3,1\n\
?#???.?????#?.#? 1,1,5,1\n\
?????.?.?#????# 1,1,1,1,4\n\
?.???????..# 1,1,2,1\n\
?????##??? 1,4,1\n\
??????.??# 1,1,1\n\
???#????.#?#?? 6,1,2\n\
????.??????.? 1,1,1,2\n\
..?.????#..???? 4,4\n\
???#.??##?..?#??. 2,3,3\n\
??.#??.?.?#???.??..? 1,1,2\n\
????.?.???? 1,1,2\n\
.????????..# 2,2,1\n\
?????????# 3,3\n\
#??#??#??##????? 1,2,6,1,1\n\
.??#???.#??#?#???? 1,2,1,1,4,1\n\
??###???##???#????? 5,8\n\
??.?.#???#????? 1,5,2\n\
?????.#?##???? 1,1,3,1\n\
#????#???#??? 2,3,3\n\
?.??.??????? 1,1,1,3\n\
.??#??#?????.?.??? 7,1,1,2\n\
??#???????#???##???? 7,9,1\n\
?????#??????.??.. 11,1\n\
??#??????#??.?.##? 3,4,3,3\n\
?..???..??##? 1,1,1,2\n\
????#???#?##??.???#. 8,3,4\n\
?##.??#.????##?# 2,2,5\n\
#???.???#?#?.?#? 1,1,5,2\n\
?????.??.#? 3,2,1\n\
?.#?#??.?#?????#. 1,1,1,1,8\n\
#????????.#??? 5,3,1,1\n\
?..#???##?.??#???? 1,1,1,3,6\n\
?##?#..??.#.?.? 3,1,1,1,1\n\
?.??????#.?#??#????. 5,1,7\n\
????#?.?#?.??#. 1,2,1,2\n\
?#?##??#??.?? 7,1,1\n\
#??#??#??????????## 1,2,3,7\n\
???##.?????#??#.#? 1,2,3,3,1,1\n\
??##?.???#?##?#?? 3,8\n\
??.?#?.??.. 1,2,1\n\
???####??.?.?#?.?# 1,4,1,1,2\n\
????###????????# 13,1\n\
#????##??###?.# 1,1,8,1\n\
??????#????##?? 1,1,2,1,2\n\
?.??.???#?#????..#. 1,2,1,5,1\n\
????#??#??#??.??.?? 8,1,1,2\n\
.???.??.??#?? 3,1,5\n\
??.#.??#.??? 1,1,3,2\n\
?#??.????????. 3,4,3\n\
???#??#?.?#?? 6,2\n\
??#???###. 1,2,4\n\
#..?#????????? 1,2,7\n\
.???????????##??? 2,1,7\n\
.##??????? 3,1,1\n\
?.#??????.?# 1,1,2,2\n\
?###??#???#??? 4,3,1,1\n\
?####?????#?##?# 13,1\n\
.#?.???????. 1,1,1,2\n\
?.????#??? 1,2,1\n\
???#??.??###????##?# 3,10,1\n\
??..????????##?#? 1,2,1,7\n\
?..?????##?.??##?? 7,5\n\
.???..???## 1,5\n\
?????.??#???????.?? 2,5,4,2\n\
.???????????? 1,1,1,6\n\
?..?????????#?#?. 1,2,1,8\n\
??#????.?????##?? 4,1,8\n\
???#.?##?????#?.# 1,1,6,1,1\n\
..??###??#?.#???#??? 7,1,6\n\
????????#??. 3,3\n\
??#??#????????????. 9,6\n\
???????????.?? 6,4\n\
????#?#?#???#? 5,7\n\
.#?##????#.#???#? 1,7,1,4\n\
?????#?.???#? 5,3\n\
?##???#??#??.?..?. 10,1,1\n\
?#????#?#????.#??# 7,1,1,1,1\n\
#?#?.??????.???????? 1,1,1,3,1,4\n\
?#??????#.???.?#?? 9,1,1\n\
#????????. 4,2\n\
??.??.#???.###? 1,1,1,1,4\n\
?#???#????##??#?? 3,2,1,2,4\n\
??#?#??????.??.?.??? 8,1,1\n\
???????#??.. 1,4\n\
.??.???#????.?????.? 5,2\n\
??#??.?.###?#??. 1,2,1,5,1\n\
?#??.??.??????? 4,1,1,2,2\n\
.?#??..??? 1,1\n\
?.??#.????.?# 1,1,2,1\n\
.??##??.#? 2,1\n\
?#???.?#????????# 1,2,4,1,2\n\
.?###????? 5,1\n\
..??.??#?????? 1,2,2\n\
??#?#?.#?.??? 6,1,1,1\n\
#?????????...#? 1,4,1,1\n\
.???????##??.?..? 1,6,1\n\
?.????.?????#?#??.?? 1,3,10\n\
?#?#???#?????#? 3,7\n\
#?????.?#???????? 5,3,1,3\n\
.#?#??.?????#?#? 3,9\n\
.#???????.? 1,1,4\n\
???.?#?????###????? 2,9\n\
?.##???#????#???? 6,2\n\
??.?#?#?#??.?#?? 1,8,1,1\n\
??????#??#??.?.#. 1,10,1,1\n\
#???.#???#. 3,1,2\n\
???????.#. 3,1,1\n\
###????.?.????.?#?.# 5,1,3,1,1\n\
.##?#???#?#????#??? 5,1,1,1,5\n\
.??????????.. 2,2\n\
?????????. 1,2,1\n\
?.??#???.???.?. 1,5,1,1\n\
???????.#.??.??#.#? 3,3,1,1,3,1\n\
#?.??.#??. 2,1,3\n\
???#?????????????. 6,7,1\n\
?.??.?#??????#???? 2,3,5\n\
???????.?????##???? 1,2,2,3,2\n\
##????#?.??.???? 5,1,1,1\n\
?.???.???? 2,2\n\
.#?#???..# 1,3,1\n\
??.?#???#????? 3,3\n\
.##????.??#.?? 3,1,2\n\
????.#??..???#?? 1,3,2,3\n\
???.?????? 3,1\n\
.?????##??# 2,7\n\
??????????? 1,3,1\n\
?.#??#?..##?. 1,2,2\n\
??#??.??.?.#?..? 2,2,2\n\
?????#?..#???##?? 4,7\n\
??.???#.???. 1,1,1,1\n\
??##??..???#???#. 5,1,3,1\n\
?.?#.????#?#?????? 1,11\n\
??#???..#???#???#? 1,1,1,1,3,1\n\
?.?#?.?.#???#???## 2,1,8\n\
##?.#??.?. 2,1,1\n\
#.?##.?.?# 1,3,2\n\
?.?##??????#?# 3,6\n\
#???..??.?. 1,1,1\n\
.?#.?.?.?.#? 1,1,1,1\n\
?#??????.?? 7,1\n\
#???#?#??# 3,3,1\n\
#??????####???????? 1,10,2\n\
????.??##????##..# 1,1,3,5,1\n\
#.##??#?#????#? 1,7,4\n\
????##??#?#?.?#. 7,4,2\n\
??#??..#??##?. 1,3,5\n\
??#.?????.? 3,1,1\n\
????????..????#??#? 6,1,4,3\n\
.????..????#???? 2,1,2,2\n\
.??##??#?. 1,6\n\
.#????.????#? 1,5\n\
??#?###????#????.? 8,3\n\
???.????..?.???.?. 3,1\n\
..?????.?##?#?? 1,5\n\
.?#??????.????#??. 7,5\n\
?.?.???????#??###??. 1,5,4\n\
????..????#??.? 1,3\n\
?####???????.? 5,3\n\
?????.#??.#? 1,3,1\n\
?.??.?###????? 1,6\n\
????..?#?#. 2,1,4\n\
##?.?????????#?? 3,10\n\
.?#??#?#??..?????? 2,1,3,2\n\
?#?#?.?.???## 4,1,5\n\
??..???????. 1,1\n\
...????.??.????.?. 1,2,4\n\
.#?????.???.??. 6,1,1,1\n\
##?.?.??.? 2,1,1\n\
??.#????#?# 1,1,5\n\
????#.?.?##.??. 3,1,1,3,1\n\
??..??##??????? 4,5\n\
???.#?????? 1,5,1\n\
??##..##..?????#??? 4,2,3,2,1\n\
?##???.?#??#?????#? 3,1,4,2,2\n\
???????.??? 6,1\n\
#?#???????#?#?? 1,7,1,1\n\
?????#???#?.??. 1,3,4\n\
..?#??.??##?#. 4,4\n\
?.????????#?#??.?#? 2,2,5,2\n\
???.?.???????? 1,1,1,1\n\
??..????.??????? 1,3,1,2\n\
?#?.?##????.??#???.? 1,4,6\n\
????.#????#?????.?? 1,1,2,5,1,1\n\
..?#.#?#?.?##??###? 1,1,2,8\n\
?#????????? 2,4\n\
?????#???? 1,1,2\n\
????.????... 1,1\n\
?????????#????? 5,8\n\
????..???.?..?#?. 1,1\n\
.?????????.#?? 2,1,2,3\n\
.??.??#?#????.?? 1,3,1,1,1\n\
?.??.???#??###?#?#?? 1,11\n\
?##????..??#????.?? 3,3\n\
?.?#???#???#??? 1,6\n\
??#?###??.???.? 6,1,1\n\
?#?##?##?.##?..? 5,2,3,1\n\
?????.?????. 3,2\n\
??????????#???? 1,8,1\n\
????.??#??. 1,5\n\
?.##???.??##??##?# 1,2,1,4,2,1\n\
??#???.??????#.#?? 1,1,1,5,1\n\
????####..?..? 8,1\n\
..?????????#?. 4,4\n\
?#????????? 1,1,4\n\
???????.????#??? 5,5\n\
#??.?#.?????..#?#??? 1,1,1,2,1,4\n\
##??#??#?.?????? 5,1,1,2\n\
.????##????##### 5,7\n\
?#.??#???#.??.? 2,7,1\n\
.????????##?..?? 2,2,1\n\
.??????#?????????.? 4,3,4,1,1\n\
??????#??.#?.???.??? 7,1,1,2\n\
?.#?#.?????##?#?#??? 1,1,1,1,1,7\n\
???????####?##?###. 1,15\n\
?????????#?.??#? 3,1,3,3\n\
##?????#???#?#?? 3,1,2,4,1\n\
.??.????.?#??#?#??# 2,1,2,4,1\n\
???#?????????#??. 3,8\n\
?.???#???#.????.???? 1,5,2,3,1,1\n\
???.??????#?? 1,2,5\n\
??#??#?#?????..?.??? 8,3,1,1,1\n\
???###??????? 7,2\n\
??????#..?..?.? 1,4,1,1,1\n\
????#??????? 1,2,2\n\
?????.?##?? 1,2\n\
??#?##????.??##???? 7,3\n\
?#???????.# 4,3,1\n\
.?????#?#?#????#?#?? 10,3\n\
.??#.???.? 2,1,1\n\
???..????.?#???#?##? 2,4,10\n\
??..??????.????.. 3,2\n\
?#???##??..????? 6,2\n\
???????##?? 1,2\n\
???#????##??# 1,3,6\n\
??.??#???????? 1,1,3,2\n\
???..?.?????.? 2,3\n\
.??.#??????..? 3,1\n\
?#???#??????#.?# 1,2,5,1\n\
??..#?#?.#?.#??????. 1,1,2,1,2,4\n\
??##????#.. 2,1,1\n\
??????????????.? 1,1,1,5\n\
??#.??.??#?#?????. 1,1,6,2\n\
.?.??..#??..? 2,3\n\
.????.???? 1,1\n\
#??..????##?.?#.# 2,7,1,1\n\
??.??.#.?.#???????# 1,1,4,3\n\
??#??#..?#????#???? 1,4,2,1,1,2\n\
???#???????# 9,1\n\
???#???#?#???#..##? 8,3,2\n\
?.##?##???#????#?#? 1,10,1,1,1\n\
?????#??#??##?.???? 6,1,4,1\n\
..###.???#? 3,3\n\
??.??.#?#?##?# 2,1,8\n\
??.#????#????.???#? 1,1,3,1,1,1\n\
??.?????#?#?????#?? 2,1,12\n\
??#.????#??##???#??? 1,13,1\n\
##??????.#??????? 6,7\n\
??????##?#?#?#?.??#? 1,10,1,2\n\
?.??#?#.??????#?# 1,3,1,2,4\n\
????????##. 2,1,3\n\
.?????.?#???#? 3,1,2\n\
????.#?#.?? 2,3\n\
??????#????##?????? 13,1,1\n\
?.???????.?? 3,2\n\
..?#?.#???? 2,1,1\n\
??.?????.??#?#??##?? 1,3,11\n\
?#????????#? 2,3,1\n\
????#?.?.###?? 4,1,5\n\
?.?#????????.?## 1,7,2\n\
.??.??????.???.. 1,3,1,1,1\n\
##.?#?#?#???? 2,7,1\n\
?#?.????#...??? 2,5,1\n\
.????.#.#?#?# 1,1,5\n\
.?.##?#??? 1,2,3\n\
##????#?????????#?#? 3,1,1,1,6\n\
.?????????.?? 2,4,1\n\
#????..?#?.?#.????#? 1,1,1,2,1,5\n\
??#??#??..# 7,1\n\
?###?.??..? 4,1,1\n\
??.??????#?#?#??..? 1,8\n\
???.?????? 2,4,1\n\
??????#??#??? 1,2,1,1\n\
??.?#??.?#???? 1,3,4\n\
#??????????? 6,1,1\n\
??#?.#?#.#??#???? 1,1,1,1,8\n\
?..???#.???##??#?. 3,7\n\
?...??????#?#?. 2,4\n\
????.??.?. 4,1\n\
#.??##??###?.?###. 1,1,8,4\n\
????.?..?#.??????? 3,1,1,1,3\n\
#.???.????#?.?.?.?# 1,2,1,3,1,2\n\
????.?.#???.???# 2,1,4,1,1\n\
???#??????????? 2,5\n\
??#?#???.#????? 4,1,1,2\n\
???#??.????.??? 5,1,2,1\n\
.????????#.???#?? 1,7,6\n\
?.??..??#?# 2,3\n\
#?????.##??.?????#? 4,1,4,1,1\n\
?#?#####?##???#????? 11,1,1,1\n\
???.##???#?. 2,6\n\
?????#?##??.?.????#. 9,5\n\
?####??..#???.? 6,2\n\
?##??#?.###?#??.??. 6,7,1\n\
?#.??.?.?#??# 1,1,1,4\n\
#?#?#???..?? 7,1\n\
??#?#??????? 5,1,1,1\n\
.?##?#?????..???.??? 10,3,1,1\n\
...?#??..??.????? 3,2\n\
??.????.??? 3,3\n\
#??#??#?#.??.#. 1,6,1,1\n\
?.??????..???#?.?.. 1,2\n\
.??.#?.?##?#??#???? 2,8,1\n\
?##?#???????##?? 2,1,3,3\n\
?#?.?????###?#????? 1,2,1,5,1\n\
?#??###????.##.? 2,7,2,1\n\
#??????..#???# 3,1,2,1\n\
??#.?????#..#???? 3,1,1,5\n\
??????#????. 8,1\n\
??????.#??. 6,1,1\n\
??#??.#??#??. 5,1,2,1\n\
?#???#?????. 5,1\n\
###?????.#?? 5,1,2\n\
..?????#.? 1,1,1\n\
?????...#??? 3,1,1\n\
????.????? 3,1\n\
.?#??#??.???? 2,2,2\n\
#??.??.??#.????.?? 3,1,1,1,4,1\n\
????#?????? 1,6\n\
?#??##????#??. 1,8\n\
????#.?.??.??##??# 1,1,2,6\n\
?????.?.????###?##? 1,1,1,1,1,7\n\
.??..#.??.?#? 1,1,2,2\n\
?##??#?.#????. 6,1,1,1\n\
??????.?#? 6,1\n\
.#??#???#??????# 2,1,1,2,1\n\
##?#??####.???#?#??. 10,6\n\
??.???????.???#. 1,2,3,1,1\n\
??#?????#?#????????? 5,9\n\
?##?#???#?.#?????? 3,1,1,1,1,2\n\
?#???#?#??#?#???.#?? 12,2,3\n\
.??#??#?.?#????.#??? 5,3,1\n\
?##??.?#??. 4,3\n\
?.##?##?.?????#?? 1,5,2,5\n\
.?..?#.?.? 1,1,1\n\
.#????#?????#??? 2,6,4\n\
..#???????.? 3,4\n\
?###??#????..?.? 7,2,1,1\n\
?#??????.#?????..?. 7,5,1\n\
?.#?#??.#??.#.??? 1,5,1,1,2\n\
.??#?#??##?#?.?#?? 12,1\n\
????##????##?????.#? 12,2\n\
#?????##??.?.#?? 1,1,4,1,1\n\
.#?#????.???? 4,1\n\
??.?.??.??????##? 1,1,1,1,5\n\
.?.#?????##???? 1,1,1,3,1\n\
#???.????# 1,1,4\n\
?????#?.???#??????? 5,9\n\
??#.?.??#???? 1,4,1\n\
?????#??.. 2,3\n\
??##???????#.??#???? 3,6,2\n\
?.?.????????? 1,7\n\
.??#..?.?#. 2,1,2\n\
????????#??#??.??#?? 4,8,3\n\
??.?????#??#????. 1,2,9\n\
?????#??.???.? 5,1\n\
?.?#??#??.????? 1,1,4,5\n\
????.??????# 1,4,1\n\
#?.??#?????##????#?# 2,2,8,3\n\
.?#????.##.???#?#? 2,2,1,4\n\
?.??#?#???#..??#.?# 1,3,5,3,2\n\
?##.???##??. 2,1,5\n\
?.??...?????.?. 1,3,1,1\n\
????#???##. 2,3,2\n\
????????.#?#?? 1,1,4\n\
??.????#???? 1,1,1,1\n\
?#?#?##??#?.?##. 10,3\n\
???#?.??#???????.? 3,10\n\
?.##????.#?.?#?? 6,1,3\n\
???#.??#?#? 1,1,4\n\
.#??????..?#??####?? 4,1,2,6\n\
???????#?..? 4,4\n\
.##?????.?.. 4,1\n\
??#??.???????.???? 1,3,1,2,1,2\n\
????#?.?????? 1,1\n\
??#?#?.?#??.?.?? 5,3,1\n\
.?#??#?#?.???###???. 2,4,9\n\
#?????.???.#?.##?# 1,1,2,1,1,4\n\
?#???.?#?.?#.?? 4,2,1,1\n\
????.???#?#?##??? 3,9\n\
.?????.?##??? 2,1,6\n\
?.#?????.?????? 6,5\n\
????...???.?? 2,2\n\
?.??.??.#?#??????#?? 1,1,1,1,2,7\n\
??.??#?#????. 1,5\n\
??#?#???.?#??? 2,1,1,4\n\
#?.??.##?????? 1,1,2,5\n\
.??#??##??? 1,6,1\n\
.???##??.??#?. 6,1\n\
????#?#?#?.??#?? 9,4\n\
??#??????#?????.# 2,2,3,1,1\n\
#?????????#?####?. 8,8\n\
???????.?.#??? 1,4,1,4\n\
.???#?.???#?#?#?. 3,8\n\
??.#??.??##??#?#?# 1,3,1,7,1\n\
#.#??#??#???? 1,1,1,4\n\
??..#???.??? 2,3,1\n\
?#?..????? 1,4\n\
????#??####??..? 1,9,1\n\
#???????##?? 2,2,5\n\
.?.????#??.????##?. 1,2,4,6\n\
?#..#.???#. 1,1,3\n\
?.?#????#??...?###? 8,4\n\
??.????##????##????. 1,1,1,8,1\n\
??..?#??????#???? 1,4,2,5\n\
#?????????..??#.?? 2,1,4,3,1\n\
.#.??.?.#????.?.??#? 1,2,3,1,1,2\n\
??#?##?.#?#?? 5,1,1,1\n\
??#???.?#???? 5,2,1\n\
?????.?##..? 3,2\n\
??.?.?#???? 1,1,2\n\
#???#?????????? 1,1,1,1,4\n\
??#?.##???..??????? 1,4,4\n\
???????#?.?.#???? 1,1,2,4\n\
.?.?##??#.#?? 1,3,1,1\n\
???????#.#??#.?#? 1,6,1,1,3\n\
??.???#?#.? 1,3,1\n\
????????...??????? 4,2\n\
?#??.??#?#? 2,5\n\
???.##??????. 1,3,1\n\
????#?.?.?? 5,1,1\n\
#??#.?#??#..?? 4,1,1,1\n\
???.?#..?# 1,1,2\n\
.#??????.????????## 6,6,2\n\
????????.??????#? 7,1,2,2\n\
???#????#???#??? 3,2,4\n\
?...????#.??. 1,1,1,2\n\
.?????.????#. 2,3\n\
????..?????? 1,1,1,1\n\
?#####??.?.#??? 5,1,1\n\
.?#?.??...??# 2,1,3\n\
??###?#??. 3,3\n\
????.#??????#??# 1,1,1,1,6\n\
.??#?###?#?#?? 1,7,1\n\
??#.???#.##.?? 1,1,2,2\n\
??#?.????.? 3,1,1\n\
????????##?????#? 1,3,2,2,1\n\
?#????#?#??.##? 7,1,2\n\
?.#?????#.??# 1,2,4,2\n\
?????.#???????.?? 5,1\n\
????#?##.???#? 7,4\n\
?#??????#?#???#??? 5,6,1,1\n\
?#?#??????.?#. 6,1,1\n\
.?###????????#?#??.? 4,9\n\
?#?#?.?#?#??#?? 3,7\n\
??#???.?????. 1,1,1,5\n\
?.##?..????.?.??# 3,1,1,1,1\n\
.#?????#???? 7,2\n\
.??.???##????#?.??. 1,1,8,2\n\
#?.?##????##?. 1,2,4\n\
#?#..?.??###???.? 1,1,1,5,1\n\
??#?#??????#??#???# 11,5\n\
????????????#? 1,1,5\n\
????#?#?.#???#. 1,6,1,1,1\n\
?#?#?##????#?..?#?? 12,4\n\
??????#.???.???.? 1,3,2,2\n\
?.?#???#?.?.?#??# 7,1,1,2\n\
#?#.?#?.?#?##???.? 3,3,6,1\n\
???.??##?.?. 1,4,1\n\
??..?#??????. 2,2,3\n\
???.?????# 3,2,1\n\
?#?#??#?.?.#?#?????? 5,2,9\n\
?.?#.??#?.?#??##??? 1,1,1,1,2,6\n\
#????#?#???????????? 8,1,1,1,1\n\
??????#?#?? 2,2,2\n\
???#??#.????..#?. 5,1,1,1,2\n\
??#?????????.#? 4,1,1,1,1\n\
?#..??##??#???. 1,10\n\
.?#????#?. 2,1,1\n\
?.????.##?#??.#? 2,6,1\n\
?##??#?..#??#????# 2,1,9\n\
?????..????##????? 4,7,1\n\
?.##??..???.?#. 1,2,1,3,1\n\
?#????#?#???? 2,1,3,1\n\
??##???.?# 4,2\n\
.?????.?.?.#? 3,1,1,1\n\
.#?##???.??####??#? 7,8\n\
??????#???.?#?..## 7,3,2\n\
?#???#?.??#?#? 3,1,5\n\
???#?.???..??? 4,3\n\
...?.?????? 2,1\n\
.#?.??#??#???#???##? 1,16\n\
?????#?????.???.??? 5,1\n\
#?.?..?#?#??? 2,1,6\n\
???#?????.???? 8,1\n\
.???#?????????.#?.? 10,2,2,1\n\
#?#?..##?????????? 4,3,1,2,1,1\n\
???#?###.???? 1,1,3,2\n\
????#???#??#?? 5,5\n\
?.????#????##? 1,6,4\n\
??????##????..???#?? 7,5\n\
#????????????? 1,8,1\n\
.????.??????#??? 2,1,2,5,1\n\
???#???..?#?? 3,4\n\
##???#???# 4,1,2\n\
??????#???????..???? 1,5,5,1\n\
.???????#. 1,1,1\n\
?..?#?#??#??. 1,6\n\
#?#????##?##??#..??? 4,1,8,2\n\
.?????????###?##??? 1,14,1\n\
????????#?.???.??.. 10,1,1\n\
????????#?????.# 1,8,1,1\n\
?.#?###?????#?????# 5,1,2,1,1,1\n\
????????#?? 1,2,2\n\
.#..??#??.?.# 1,5,1\n\
???.??????#.??..# 1,1,5,1,1\n\
?#.?????.???#?#????# 2,1,2,6,3\n\
.?#??.??.???#.?#.?? 3,2,1,1,2,1\n\
???#?#????.??? 6,2,1,1\n\
?????##???.??#? 1,2,2,1,4\n\
#???????#????? 1,1,6,1\n\
.#???###????????.? 2,3,1,2,1\n\
???????????????? 1,3,1,1,3\n\
..#???#?????#?. 1,3,1,2\n\
#?.?????##?. 1,6\n\
????.#???#?????. 3,1,3,1,1\n\
.#???.?#..#???# 2,1,1,3\n\
??.?###?????.. 1,7\n\
?#?.??#.????## 2,2,1,3\n\
?????.##??.. 1,1,3\n\
????####??#????? 13,1\n\
?.??##??.?.??#???? 6,6\n\
????#.??##??. 3,5\n\
???#??????????#??. 4,11\n\
????..#?#?.??#??# 2,3,1,2,1\n\
?#?????.?#??????.. 6,8\n\
??..#.??????#? 1,1,1,4\n\
.?#?????.???????? 5,6\n\
??.????????.#? 2,1,1\n\
??????##?? 3,4\n\
??????????? 8,1\n\
?#??.?.?###??##?? 1,1,8\n\
?????#?#?????????.?? 2,9,3\n\
...#???.???.. 2,1,2\n\
#??.#?#??..??????.. 2,1,2,6\n\
?.?#??.?#? 4,2\n\
?#?????..? 1,2,1\n\
#?.#?.??#??.? 2,1,3,1\n\
????.#.#??????#?## 2,1,1,3,6\n";
#endif

#define MAX_DAMAGED_SETS
int damaged[10];
int num_damaged_sets;

#if 0
int count_combinations(const char* set, int idx)
{
    while (*set == '.') set++;
    if (*set == ' ') return 0;

    const char* s = set;
    int unknown_at_start = 0;
    while (*s == '?') {
        unknown_at_start++;
        s++;
    }
    int unknown_at_end = unknown_at_start;
    int max_len = 0;
    while (*s == '#') {
        max_len += unknown_at_end + 1;
        unknown_at_end = 0;
        s++;

        while (*s == '?') {
            unknown_at_end++;
            s++;
        }
    }
    max_len += unknown_at_end;

    int reqd_len = damaged[idx];
    //printf(" %d %d %d %d\n", unknown_at_start, unknown_at_end, reqd_len, max_len);
    if (max_len < reqd_len) {
        if (unknown_at_start == max_len) {
            if (*s++ != ' ') {
                return count_combinations(s, idx);
            }
        }
        return 0;
    }

    if (idx == num_damaged_sets - 1) {
        while (*s != ' ') {
            if (*s++ != '.') return 0;
        }

        if (unknown_at_start != max_len) {
            int min_len = max_len - unknown_at_start - unknown_at_end;        
            if (min_len > reqd_len) return 0;

            unknown_at_start = min(unknown_at_start, reqd_len - min_len);
            unknown_at_end = min(unknown_at_end, reqd_len - min_len);
        }

        return max(min(min(max_len - reqd_len, unknown_at_start), unknown_at_end) + 1, 0);
    }

    int combs = 0;

    if (unknown_at_start == max_len) {
        if (*s++ != ' ') {
            combs = count_combinations(s, idx);
        }
    }

    for (int i = 0; i <= unknown_at_start && max_len - i >= reqd_len; ++i) {
        s = set + i + reqd_len;
        if (*s == '#') continue;
        if (*s++ == ' ') {
            return combs;
        }
        if (idx < num_damaged_sets - 1) {
            if (*s != ' ') {
                combs += count_combinations(s, idx+1);
                //printf("  %d %d %d\n", idx, combs, i);
            }
        }
    }

    return combs;
}
#else
int count_combinations(const char* set, int reqd_len, int next_idx)
{
    if (reqd_len == damaged[next_idx-1]) {
        while (*set == '.') set++;
        if (*set == ' ') return 0;
    }
    else if (reqd_len != 0 && (*set == '.' || *set == ' ')) return 0;

    while (*set == '#') {
        if (--reqd_len < 0) return 0;
        ++set;
    }

    if (reqd_len == 0) {
        if (next_idx == num_damaged_sets) {
            const char* s = set;
            while (*s != ' ') {
                if (*s++ == '#') return 0;
            }
            return 1;
        }
        if (*set == ' ') return 0;
        
        return count_combinations(set + 1, damaged[next_idx], next_idx + 1);
    }
    else if (*set == '?') {
        int combs = count_combinations(set+1, reqd_len-1, next_idx);
        if (reqd_len == damaged[next_idx-1]) {
            combs += count_combinations(set+1, reqd_len, next_idx);
        }
        return combs;
    }

    return 0;
}
#endif

int main()
{
    const char* ptr = data;

    int total = 0;
    while (*ptr) {
        const char* set = ptr;
        while (*ptr++ != ' ');

        num_damaged_sets = 0;
        do {
            ptr = read_num(ptr, &damaged[num_damaged_sets++]);
        } while (*ptr++ == ',');

        int combs = count_combinations(set, damaged[0], 1);
        printf("%d\n", combs);
        total += combs;
    }

    printf("\n%d\n", total);
 
    return 0;
}