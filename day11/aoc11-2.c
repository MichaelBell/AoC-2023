#include "../aoc.h"

#include <stdbool.h>
#include <stdlib.h>

#if 0
const char* data = "...#......\n\
.......#..\n\
#.........\n\
..........\n\
......#...\n\
.#........\n\
.........#\n\
..........\n\
.......#..\n\
#...#.....\n";
#else
const char* data = ".....................#..................#..................................................................#...........#....................\n\
................................................................#..................#........................................................\n\
..........................#.....#.............................................................#........#..................................#.\n\
...#.......#...........................................#........................................................#...........................\n\
............................................................................................................................................\n\
........................................................................#.....#.................................................#......#....\n\
...............................................#.................#...................#......#..............#................................\n\
.................#.................#.....................................................................................#.................#\n\
......................#....................................................#................................................................\n\
...........#.......................................................................................#........................................\n\
...........................#......................#............................#.......#.....................................#..............\n\
........................................................#......#.......#................................#.........................#......#..\n\
...............................................................................................#............................................\n\
.#.....................#..................#.....................................................................#...........................\n\
..............................#......#.................................................................................#....................\n\
................#....................................#.......................#..............................................................\n\
........#...................................................................................#..............................................#\n\
.........................#....................................#.......................................#............#........................\n\
...................................................................#..............#.........................................................\n\
..................................#...........#...............................................................#.............................\n\
.#.................................................................................................#.....................#..................\n\
.........#...................................................................................#..............................................\n\
..............#........................#...............#.............#...............................................................#......\n\
..........................#............................................................................#.............#......................\n\
.................................................................................#.....#....................................................\n\
.......#...................................................#...............#....................................................#...........\n\
....................................#.......#.....................................................#.........................................\n\
#...............................................................#.....................................................................#.....\n\
...............#..................................#.........................................................#..........#....................\n\
................................#.................................................................................................#.........\n\
.........................#.......................................................#.........................................................#\n\
............................................................#...........#...............#...................................................\n\
....#......#.....................................................#..........................................................................\n\
........................................................................................................#.......................#.....#.....\n\
.............................................................................................#..............................................\n\
....................................#........#.......................................#.....................................#................\n\
...........................................................................................................#.......#........................\n\
#........................#.............................#..........................................................................#.........\n\
...........#......................................#.........................#..........................#.................................#..\n\
................#.....................#...........................................#.........................................................\n\
...#.............................#...........................................................................#.........#....................\n\
............................................#.......................#...........................#...........................................\n\
.....................................................................................................#......................#...............\n\
#.........................................................................................#.................................................\n\
.............................#.......................................................................................#....................#.\n\
...........#.............................#......#........#.....#.......#......#.............................#...............................\n\
...................#........................................................................................................................\n\
...................................................................................................................................#........\n\
.#............#.............................#......#...............................#....................................#...................\n\
..........................#.........#...................................................................#...................................\n\
.....................................................................#.............................#...........................#............\n\
................................................................................................................#...........................\n\
...........................................................#..................................#.............................................\n\
........#....................#....................................#...................#.................................................#...\n\
...#...............#.............................#.....................................................................#....................\n\
.........................#..........#.....#................................#........................#.......................................\n\
................................................................................#..............................#................#...........\n\
............................................................................................................................................\n\
....................................................................................#........#..............................................\n\
............................................................#..........#..........................#.........................................\n\
.............................#........#................#................................................#...............#...................\n\
......................#............................................#........................................................................\n\
.#..........#.........................................................................#.....................................................\n\
..................#..........................................................................................#...................#..........\n\
.......#.........................#................#..........................#.......................#................#................#....\n\
.........................................................#..................................................................................\n\
.....................................................................#......................................................................\n\
............................................#...................#....................#.............................#........................\n\
......................................#.....................................................................................................\n\
...#.......................................................................................................................#................\n\
.......................#..........................#......................................................#.....#............................\n\
.................................#..........................................................................................................\n\
.............#....................................................#........#...........................................................#....\n\
............................................................................................................................................\n\
............................................................................................................................................\n\
.................................................#.....#....................................#......................#..............#.........\n\
.................#............................................................#.............................#.............................#.\n\
............#............................#.........................................#.............#..........................................\n\
.......#...............#........................................................................................#...........................\n\
..................................#............#..............#.....#..................................#....................................\n\
...........................................................................#................................................................\n\
..#.......#.....#............#...........................#............................#..............................#......................\n\
........................................#.......................................#.................#.......................................#.\n\
............................................................................................................................................\n\
..........................#.......................#..............#..........................................................................\n\
..................................#.........................................................................................................\n\
.#..................................................................................................................#.......................\n\
................#.....................#.....................#...............#...................#............#..............................\n\
.........#..................................................................................................................................\n\
................................#..............#........................#.................#........................................#........\n\
............................................................................................................................................\n\
#...................#...................#.......................................................................#........................#..\n\
............................#....................................#............#.......#....................#................................\n\
............................................................#......................................#........................................\n\
...................................................................................................................#.........#..............\n\
..................................................#.................#....................#..............................#...................\n\
........................#..............................#..........................#.........................................................\n\
............#..........................#...................................#.....................#.......#..........................#.......\n\
..................#.............#...........................................................................................................\n\
.....#......................................................................................................................................\n\
.......................................................................#..............................................#.....................\n\
.........#................#................................#........................#.......................#...............................\n\
....................#................#.......#.....................................................................................#........\n\
..................................................#.........................#........................#.............#..........#.............\n\
.#...................................................................#......................................................................\n\
.................................................................................#......#.....................#........#....................\n\
.....#...................................#..................................................................................................\n\
.....................................................#.................................................#....................................\n\
..............#...................#.............................#.................................................................#......#..\n\
........#...........#.......................................................................#.............................#.................\n\
.................................................................................................#..........................................\n\
..........................................................................................................#.....#...........................\n\
..........................#........................#........................................................................................\n\
.#................#.......................#.......................................#..................................#......................\n\
.........#.....................#.....#.................................................................................................#....\n\
............................................................................................#...............................................\n\
.....................................................................#.......................................#..............................\n\
..............................................#............................#............................#.....................#.............\n\
.........................................#................#......................................#.....................#....................\n\
................................#...........................................................................................................\n\
#.....#.........#...............................................#.............#.............................................................\n\
...........................#.......................................................#......................#.................#.......#......#\n\
...........................................................................................#........#.......................................\n\
....................#...................#................#..............#...................................................................\n\
..............................................................#.............................................................................\n\
..........#.......................#..................................................#...............................#......................\n\
...............#..............................................................................#........#.............................#......\n\
.........................#...................#.......#.............#...........................................#...........#................\n\
.....................................#....................................................#.................................................\n\
....................#.............................................................#.....................................................#...\n\
.......#....................................................................#...............................................................\n\
...............................................................#....................................#...........................#...........\n\
...............#...........................#..........................................................................#.....................\n\
.................................#......................................................#...........................................#.......\n\
#........#.........................................#......#.................................................................................\n\
..............................................................................#..........................#..................................\n\
.....#..................#...................................................................................................................\n\
.......................................................#.......#.....#...........................................#.............#............\n\
....................#...............#............#..........................................................................................\n\
.................................................................................#......#..............................................#....\n";
#endif

typedef struct {
    uint32_t x;
    uint32_t y;
} pos_t;

#define EXPANSION 1000000

#define MAX_GALAXIES 1000
pos_t galaxies[MAX_GALAXIES];
int num_galaxies = 0;

#define MAX_COLS 255
uint32_t col_map[MAX_COLS] = {};

uint32_t width = 0;
uint32_t height;

int main()
{
    const char* ptr = data;

    uint32_t x = 0;
    uint32_t y = 0;
    bool empty_row = true;

    while (*ptr) {
        if (*ptr == '\n') {
            if (width == 0) {
                if (ptr - data > 255) fail();
                width = ptr - data;
            }
            if (empty_row) y += EXPANSION - 1;
            empty_row = true;
            x = 0;
            ++y;
            if (y == 0) fail();
        }
        else if (*ptr == '#') {
            galaxies[num_galaxies].x = x;
            galaxies[num_galaxies++].y = y;
            empty_row = false;
            col_map[x] = 1;
            ++x;
        }
        else {
            ++x;
        }
        ++ptr;
    }

    height = y;

    //printf("%d %d %d\n", width, height, num_galaxies);

    for (uint32_t i = 0, j = 0; j < width; ++i, ++j) {
        if (col_map[i] == 0) {
            width += EXPANSION-1;
            if (width < EXPANSION) fail();
            j += EXPANSION-1;
        }
        else {
            col_map[i] = j;
        }
    }

    for (int j = 0; j < num_galaxies; ++j) {
        galaxies[j].x = col_map[galaxies[j].x];
        //printf("%d %d\n", galaxies[j].x, galaxies[j].y);
    }

    uint64_t total = 0;
    for (int i = 0; i < num_galaxies - 1; ++i) {
        for (int j = i+1; j < num_galaxies; ++j) {
            total += abs(galaxies[i].x - galaxies[j].x) + abs(galaxies[i].y - galaxies[j].y);
        }
    }

    printf("\n%llu\n", total);
 
    return 0;
}
